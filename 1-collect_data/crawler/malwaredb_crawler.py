from urllib import urlopen
from bs4 import BeautifulSoup
import re

from zipfile import ZipFile


_link = '(?<=a href=\".)(.*)(?=\"><img)'
_md5 = '[a-z0-9]{32}(?=</a>)'

link_pattern = re.compile(_link)

def get_html(url):
	try:
		html = urlopen(url).read().decode('utf-8')
	except:
		return None

	if(html == None):
		print "can't get the page you request, please check 'URL'"
	else:
		bsObj = BeautifulSoup(html, 'html5lib')
		for td in bsObj.find('table').findAll('td'):

			down_link = link_pattern.findall(str(td))

			if down_link:
				down_link = down_link[0]
				md5_hash = down_link.split('=')[1]
				print down_link, md5_hash

				get_download(down_link, url, md5_hash)

	return bsObj

def get_download(link, url, _md5):
	file_loc = url + link
	data = urlopen(file_loc).read()
	
	filename = _md5 + ".zip"

	with open(filename, "wb") as code:
		code.write(data)

	with ZipFile(filename) as zf:
		print zf.extractall(pwd='infected')



url = "http://malwaredb.malekal.com/"
rns = get_html(url)

