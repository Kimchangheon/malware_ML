from sklearn.externals import joblib
import numpy as np
import extract
import csv

filepath = '/home/stud/PJ/PJ1_malware/samples/test/malware'

ft = extract.PE_features(filepath)
data, magic = ft.extract_all()

# data[63] = packer_type
# magic = 32bit or 64bit ( 267 = 32bit )
# len(data) = 69 : ok

if magic != 267:
	print "64-bit File. cannot process"
elif len(data) != 69:
	print "File corrupted"

f = open('patterns.csv', 'r')
rd = csv.reader(f)
for row in rd:
	patterns = row

packer_type = [0] * len(patterns)

try:
	idx = patterns.index(data[63])
except ValueError:
	idx = 10

packer_type[idx] = 1
del data[63]
data = data + packer_type
print len(data)
data = np.asarray(data).reshape((1, -1))
print data.shape
clf = joblib.load('model.joblib')
rns = clf.predict_proba(data)[0][1]
print rns
